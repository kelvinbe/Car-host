# Divvly mobile app

The divvly mobile app is a React Native app that is built using Expo.

## Getting started

1. Install Expo CLI: `npm install -g expo-cli`
2. Install application dependancies `npm install`
3. Start the application `npm start`
4. Scan the QR code with the Expo app on your phone from within the expo app
5. Make changes to the code and see them reflected in the app

### Alternatively

- Web
  - `npm start --web`
  - Open the browser at http://localhost:19006
- iOS
  - `npm start --ios`
  - tbd

## Folder structure

- `assets` - Images and other assets
- `components` - React components
- `constants` - Constants used throughout the app
- `navigation` - Navigation configuration
- `screens` - Screens
- `store` - Redux store configuration
- `storybook` - Storybook configuration
- `hooks` - Custom hooks
- `jest` - Jest configuration
- `coverage` - Jest coverage report
- `.expo` - automatically generated by expo, dont edit

## npm scripts

| Script                  | Description                                         |
| ----------------------- | --------------------------------------------------- |
| `npm start`             | Starts the expo app                                 |
| `npm run web`           | Starts the expo app in the browser                  |
| `npm run ios`           | Starts the expo app in the iOS simulator            |
| `npm run android`       | Starts the expo app in the Android simulator        |
| `npm run storybook`     | Starts the storybook app                            |
| `npm run test`          | Runs the jest tests                                 |
| `npm run test:watch`    | Runs the jest tests in watch mode                   |
| `npm run test:coverage` | Runs the jest tests and generates a coverage report |
| `npm run lint`          | Runs the linter                                     |
| `npm run lint:fix`      | Runs the linter and fixes any issues                |
| `npm run format`        | Runs the formatter `ðŸ‘ˆ run before committing`       |
| `npm run mock`          | Starts the mock server                              |

# How to use

## Storybook

**Note** Storybook for React Native is different from storybook for web in a number of ways.

- Storybook for RN is only available in version 5.3.0 - 5.3.19, so you will be working with an older version of storybook.
- To view your stories in the browser you will have to run `npm run web` and then open the browser at http://localhost:19006, it will not work on the storybook app opened with `npm run storybook` on `port:7007`, view this issue for more info ðŸ‘‰ [the issue](https://github.com/storybookjs/storybook/issues/3353)

### setting up

**Note** Inorder to view the stories in the app, you will first need to run `npm run storybook`, this will add your stories from wherever you have placed them within, either the components or screens folder (`this can be changed within the package.json to include any other folder you want`). Once that is done, you can run `npm run web` to open the app in the browser, and you shold see one of the bottom tab navigators labelled storybook, you can naigate to that and interact with your stories.

- To add a story, create a file with the extension `.stories.js/ts/tsx` in the components or screens folder, and add your stories to that file.

## Redux

For state management we are currently using redux with redux toolkit. The store related configurations are in the `store` folder.

## Testing

For testing we are using jest and react native testing library. jest related configurations are in the package.json file and the jest folder.

- When adding tests add them to the `__test__` folder within the component you are creating, this is to make the tests organized, so that we dont have the code generated by each test sprinkled around the same folder as your component.


## Mock API
For mocking the API we are using [json-mock-api](https://www.npmjs.com/package/json-mock-api). The mock server is configured in the `mock` folder. To start the mock server run `npm run mock`.

Then run `npm run generate-db` to generate json-data that gets used by json-server after you run `npm run mock`.


## Working with expo
- You will need to authenticate with the expo cli for authentication on the app to work.to do so run ``npx expo login``
- Inorder to start the expo dev server in  a tunnel you will need to run ``npx expo start -c --tunnel``

## Working with mock server in code spaces
#### Setup
- ``ngrok`` comes installed on the workspace templates by default
- all you will need to do is to sign in with your ngrok token. Instructions on how to do so are outlined in [the ngrok dashboard](https://dashboard.ngrok.com/get-started/your-authtoken)
-----
- Once the repo has been cloned into your codespaces workspace, You'll first need to setup the env variables for both the mock server and the app. To do this, get a list of the env variables.
note there are two sets of them
- The first
  Meant for the web app, which will be placed in the root `.env` file

- The second
  Meant for the mock server, which will be placed in the `mock/.env` file

- after you are done setting those up, you will need to sign in to your ngrok account and coppy your auth token. You'll then paste it in the `mock/.env`file as the value of the `NGROK_AUTH_TOKEN` variable.

- Running the mock server
  - To run the mock server, you'll need to run the following commands in the terminal:
  - `npm run generate-db` to generate all the mock data
  - `npm run mock` to start the mock server up
- On running the mock server, you'll notice some descriptive text output in the terminal specifying a url to the mock server. Copy that url and paste it in the `API_URL` variable in the `.env` file.

#### Things to note
- The urls generated by ngrok are not static, so you'll need to update the `API_URL` variable in the `.env` file everytime you restart the mock server.

- You won't be able to work with the mock server in codespaces if you don't use ngrok.
